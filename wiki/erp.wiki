<wiki:toc max_depth="4" />

== 模块 ==

||SL||销售||
||PC||采购||
||MS||维护||
||DA||基础数据||
||FN||财务||
||YD||生产||
||ST||仓库||
||SR||工资||
||FA||资产||
||EG||工程项目||
||OA||办公||
||||通讯||


== 表 ==

=== 命名规范===

1. 所有表以模块名为前缀

2. 命名主要采用单数，如MSUSER

3. 主键均命名为id,identity

4. master -detail 表加上Master,Detail后缀，如SLOrderMaster,SLOrderDetail 表示销售订单和销售订单明细

5. 所有表格(排除明细表)均包括 RecordState/CreateUserId/CreateDate(getdate()默认值) 字段

6. 明细表引用主表字段强制为MasterId ,int not null

7. 单据类主表均有Code字段（varchar(20)),用GetMaxCode('Code',表名Master,TFlag.Number) 取值


=== RecordState 字段 ===
||取值||说明||
||临时||新增加||
||提交||编辑-提交||
||审批||||
||注销||||
||删除||已经被删除||


提交-审批-注销 均视为递交状态



=== 销售模块 ===

||表||说明||
||SLContract||销售合同||
||SLOrderMaster/SLOrderDetail||销售订单和明细||
||SLSaleMaster/SLSaleDetail||销售开单和明细||
||FNClearSLMaster/FNClearSLDetail||销售结算||
||SLGoodsOutMaster/SLGoodsOutDetail||销售出库||
||SLSaleClientMaster/SLSaleClientDetail||连锁加盟销售||


||mscompanyuser||请理解成company,TGuarder.GetCompanyUserName 取其名称||
||MSPostionClass||职位类别||
||DAExpenseClass||费用类别，如果为空，默认为插入费用项目||
||dagoodsclass||默认为插入商品分类||
||mscurrency||货币，默认为插入人民币,isLocation=true||
||DAArea||区域，默认会插入所有地区||
||STWarehouse||仓库,默认会插入所有仓库||
||FNAccounts||资金账户,默认为插入1,业主资金帐户，业主资金，但这里硬编码货币编号为1,可能存在问题||
||mssysparameter||系统参数||


== 表单 ==

=== 表单继承体系 ===

WSCustomForm -> TWSEditForm -> TWSVoucherEditForm -> TBaseVoucherEditForm

==== WSCustomForm ====

实现OnClose事件，如果FormStyle为 fsMdiChild,则 action为faFree

==== TWSEditForm ====

增加Edit/Enter(重载)方法

====TWSVoucherEditForm ====

属性 MasterDataSet,DetailDataSet TADODataSet类型，从MasterDataSource,DetailDataSource 的DataSet属性而来

VoucherIDField 注意默认取MasterDataSet的第一个字段,按命名规范通常是ID

VoucherTableName 不包括前后缀的表名，如销售开单就是SLSale(自动转换为SLSaleMaster,SLSaleDetail按命名规范)

新增，删除明细操作DetailDataSet.append,DetailDataSet.delete

MasterDataSet commandText规范

select * from voucherTableNameMaster where voucherIdField = :vocherIdField

select * from voucherTableNameDetail where  MasterId=:vocherIdField


①引用




有权限判断

如果userid为1,有所有权限，不好

用userid为roleid查询MSRolePermissions表，有则有权限，否则无





TGuarder.GetUsername  对于userid为-1从 msrole中取，否则从msuser中取

部门窗体在打开时会检查msdepartment是否存在记录，如果不存在，则插入以公司名为部门名的记录
（CreateUserId=1,upid=-1)

属性词典窗体在打开时如果检查为无记录，会自动插入商品属性资料，学历属性资料

职位类别窗体无记录时会自动插入职别工种记录

== 已知问题 ===

1.部门编辑点击确定没有关闭？

2. msbremployee窗口部门和员工变量名称不规范 tblgoods,tblDaGoods

3. 职别工种点击确定无效

4. 生产入库提示缺少标准单位成本字段(PriceCost)






== 改进 ==

=== 从一个元数据库自动生成导航 ===

原系统有一个MainMenu,ActionList 每个功能需要手动添加到MainMenu和在actionList中添加action,并将menu的Action设置为 ActionList 中的action

outlookbar是遍历actionList中的 action,根据action的category和caption生成page和item


②添加自动更新

③添加工作流