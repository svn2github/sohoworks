<wiki:toc max_depth="4" />

===报表===


====明确需求====

1. 统计范围，是月报表还是合计报表

2. 查询条件，是日期范围还是需要按类别，线路等条件

3. 是否需要输出全部仪表，包括没有记录

4. 作用于原始数据还是当前数据

5. 排序等其它条件

以遵义报表为例，我们可以明确


月报表，查询条件是按月，仅作用有数据的报表，按类别和电压等级排序，同类单元格合并，计算分类合格率和综合合格率


==== 全部数据约束====

1. 用户只能查看自己所在单位下属线路的仪表记录

2. 如果定义了线路权限，则只能查看该线路权限下的记录

3. 仪表的参与统计为1

4. 仪表所在类别的排除为0



====约定====

1. 综合电压合格率运算按仪表类别中设定的比率进行

2. 城市、农村的区分按仪表定义中的城市农村的设定进行

===流程===

1. 创建excel文件

2. 定义模板

.net <#数据集名称.字段名>  <#变量名>

marsx <##数据集名称##字段名> <#.变量名>

名称 __数据集名称__


====建议=====

1. 不建议在sql 中计算超限率和合格率

如果在sql 中计算，则必须判断运行总时为零的情况

月报表时

{{{

 (case when total_time=0 then 0 else (total_time-hi_time-low_time)/total_time end ) as pass_rate

}}}

或汇总时

{{{ 

(case when sum(total_time)=0 then 0 else (sum(total_time)-sum(hi_time)-sum(low_time))/sum(total_time end ) as pass_rate

}}}